<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>activation - Introduction to Netidx</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../quick_start.html"><strong aria-hidden="true">1.</strong> Quick Start</a></li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../examples/overview.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../examples/vmstat.html"><strong aria-hidden="true">3.1.</strong> Publishing vmstat</a></li><li class="chapter-item expanded "><a href="../examples/integration.html"><strong aria-hidden="true">3.2.</strong> Integration into an Existing System</a></li><li class="chapter-item expanded "><a href="../examples/complete_system.html"><strong aria-hidden="true">3.3.</strong> Clean Slate System Design</a></li></ol></li><li class="chapter-item expanded "><a href="../administration/overview.html"><strong aria-hidden="true">4.</strong> Administration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../administration/configuration.html"><strong aria-hidden="true">4.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../administration/authorization.html"><strong aria-hidden="true">4.2.</strong> Authorization</a></li><li class="chapter-item expanded "><a href="../administration/startup.html"><strong aria-hidden="true">4.3.</strong> Running the Resolver Server</a></li><li class="chapter-item expanded "><a href="../administration/listener_check.html"><strong aria-hidden="true">4.4.</strong> Listener Check</a></li><li class="chapter-item expanded "><a href="../administration/subscription_flow.html"><strong aria-hidden="true">4.5.</strong> Subscription Flow</a></li><li class="chapter-item expanded "><a href="../administration/fault_tolerance.html"><strong aria-hidden="true">4.6.</strong> Fault Tolerance</a></li></ol></li><li class="chapter-item expanded "><a href="../tools/overview.html"><strong aria-hidden="true">5.</strong> Command Line Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tools/publisher.html"><strong aria-hidden="true">5.1.</strong> publisher</a></li><li class="chapter-item expanded "><a href="../tools/subscriber.html"><strong aria-hidden="true">5.2.</strong> subscriber</a></li><li class="chapter-item expanded "><a href="../tools/resolver.html"><strong aria-hidden="true">5.3.</strong> resolver</a></li><li class="chapter-item expanded "><a href="../tools/recorder.html"><strong aria-hidden="true">5.4.</strong> recorder</a></li><li class="chapter-item expanded "><a href="../tools/container.html"><strong aria-hidden="true">5.5.</strong> container</a></li><li class="chapter-item expanded "><a href="../tools/activation.html" class="active"><strong aria-hidden="true">5.6.</strong> activation</a></li><li class="chapter-item expanded "><a href="../tools/stress.html"><strong aria-hidden="true">5.7.</strong> stress</a></li></ol></li><li class="chapter-item expanded "><a href="../browser/overview.html"><strong aria-hidden="true">6.</strong> Browser</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../browser/views.html"><strong aria-hidden="true">6.1.</strong> Constructing Custom Views</a></li><li class="chapter-item expanded "><a href="../browser/scripting.html"><strong aria-hidden="true">6.2.</strong> BScript</a></li><li class="chapter-item expanded "><a href="../browser/bscript-stdfn.html"><strong aria-hidden="true">6.3.</strong> BScript Std Reference</a></li><li class="chapter-item expanded "><a href="../browser/bscript-browser.html"><strong aria-hidden="true">6.4.</strong> BScript Browser Reference</a></li><li class="chapter-item expanded "><a href="../browser/bscript-container.html"><strong aria-hidden="true">6.5.</strong> BScript Container Reference</a></li></ol></li><li class="chapter-item expanded "><a href="../protocols/overview.html"><strong aria-hidden="true">7.</strong> Protocols Built on Netidx</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocols/rpc.html"><strong aria-hidden="true">7.1.</strong> Remote Procedure Call</a></li><li class="chapter-item expanded "><a href="../protocols/clustering.html"><strong aria-hidden="true">7.2.</strong> Clustering</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Introduction to Netidx</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="activation"><a class="header" href="#activation">Activation</a></h1>
<p>Activation is a process manager for netidx somewhat like systemd or
dbus activation. It's core function is to install a default publisher
at configured trigger paths, and then start a process whenever someone
tries to subscribe to anything under the trigger path. Publishers for
many kinds of services can thus be started on demand, and can shut
down when no one is using them. This can save resources, and it can
also simplify starting up all the &quot;moving parts&quot; of a complex service.</p>
<p>In fact a convenient way to run netidx on both a server or a
workstation is to configure all your netidx applications, including
the resolver server, as activation units, and then start the
activation server on startup with systemd. There are a number of
benefits to this, including, single command start/stop of everything
netidx, unified logs, unified setting of environment variables like
RUST_LOG, and resource control via cgroups.</p>
<h2 id="units"><a class="header" href="#units">Units</a></h2>
<p>Each managed process is configured with a unit file. Unit files are
placed in a directory, by default <code>/etc/netidx/activation</code> or
<code>~/.config/netidx/activation</code>. The user specific directory will take
prescidence if it exists.</p>
<p>Here is an example activation unit triggered on access to any path
under <code>/local/music</code></p>
<pre><code class="language-json">{
  &quot;trigger&quot;: {
    &quot;OnAccess&quot;: [
      &quot;/local/music&quot;
    ]
  },
  &quot;process&quot;: {
    &quot;exe&quot;: &quot;/home/eric/.cargo/bin/demoscene&quot;,
    &quot;args&quot;: [
      &quot;--base&quot;,
      &quot;/local/music&quot;,
      &quot;--library&quot;,
      &quot;/home/eric/mus&quot;
    ]
  }
}
</code></pre>
<p>Many optional fields exist, here is a list of all possible options and
their function.</p>
<ul>
<li><code>trigger</code>: either OnAccess followed by a list of paths, or OnStart.
<ul>
<li>
<p><code>OnAccess</code> will start the process whenever a subscriber tries to
subscribe to any path under one of the trigger paths. Once the
process starts the activation server will remove the default
publisher from the trigger paths. If the unit's process dies, the
activation server will readd the default publishers to the trigger
paths, but it will only start the process again if a subscriber
tries to access one of the trigger paths. So unused services can
shut down and will stay shut down until someone wants them.</p>
<p>It is an error for multiple units to have overlapping triggers.</p>
</li>
<li>
<p><code>OnStart</code> will start the process when the activation server starts,
and if it dies will restart it according to the restart directive
of the process config.</p>
</li>
</ul>
</li>
<li><code>process</code>: The process config defines what to start, and gives options
to control it's environment and how it should be restarted if it
stops.
<ul>
<li><code>exe</code>: The path to the executable to start. This is the only
required field of the process config. The specified file must
exist and must be executable when the unit is loaded otherwise
loading the unit will fail.</li>
<li><code>args</code>: A list of arguments to the executable. default [].</li>
<li><code>working_directory</code>: Path to the directory where the executable will
be started. default the working directory of the activation
server.</li>
<li><code>uid</code>: The numeric user id to run the process as. default the uid of
the activation server.</li>
<li><code>gid</code>: The numeric group id to run the process as. default the gid
of the activation server.</li>
<li><code>restart</code>: Yes, No, or RateLimited with an f64 number of seconds
delay. Default <code>&quot;RateLimited&quot;: 1.</code>.</li>
<li><code>stdin</code>: The path to the file, pipe, etc that
will be set as the processes stdin. default, inherited from the
activation server.</li>
<li><code>stdout</code>: The path to the file, pipe, etc that will be set as the
processes stdout. default, inherited from the activation server.</li>
<li><code>stderr</code>: The path to the file, pipe, etc that will be set as the
processes stderr. default, inherited from the activation server.</li>
<li><code>environment</code>: either Inherit followed by a list of environment
mappings to be overridden or replace followed by the full list of
environment mappings. e.g.
<pre><code class="language-json">&quot;Inherit&quot;: {
  &quot;PATH&quot;: &quot;/bin:/usr/bin&quot;,
  &quot;TERM&quot;: &quot;xterm&quot;,
  ...
}
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="signals"><a class="header" href="#signals">Signals</a></h2>
<p>Sending <code>SIGHUP</code> to the running activation server will cause it to
reread it's unit directory. This may trigger processes (for example a
newly added OnStart process) to start up immediatly. If unit files are
removed, their corresponding processes will be stopped upon unit
directory reread. If process config properties are changed for an
existing unit, any running process will NOT be restarted, however new
configuration directives will take effect if the process dies and is
triggered. For example if args is changed for a unit that is running,
and it later dies and is triggered again it will be started with the
new args.</p>
<p>On receiving <code>SIGQUIT</code>, <code>SIGINT</code>, or <code>SIGTERM</code>, the activation server
will stop all the processes it is managing before shutting down
itself. Managed processes are first sent <code>SIGTERM</code>, but if they don't
shut down within 30 seconds they are killed with <code>SIGKILL</code>.</p>
<h2 id="args"><a class="header" href="#args">Args</a></h2>
<ul>
<li><code>-f, --foreground</code>: don't daemonize</li>
<li><code>-a, --auth</code>: auth mechanism. either anonymous, local, or
krb5. default krb5.</li>
<li><code>-b, --bind</code>: bind address.</li>
<li><code>-c, --config</code>: path to the netidx client config</li>
<li><code>--pid-file</code>: path to the pid file you want the activation server to
write. default no pid file.</li>
<li><code>--spn</code>: the spn of the activation server. only relevant if auth =
krb5</li>
<li><code>-u, --units</code>: the path to the directory containing unit
files. default <code>/etc/netidx/activation</code> or
<code>~/.config/netidx/activation</code></li>
<li><code>--upn</code>: the upn to use when connecting to the resolver, only valid
if auth = krb5. default the current user.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tools/container.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../tools/stress.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tools/container.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../tools/stress.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
