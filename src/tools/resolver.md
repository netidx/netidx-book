# Resolver Command Line Tool

The resolver command line tool allows you to query and update the
resolver server from the command line. There are several kinds of
querys/manipulations it can perform,

- `list`: list entries matching a specified pattern
- `table`: query the table descriptor for a path
- `resolve`: see what a path resolves to
- `add`: add a new entry
- `remove`: remove an entry

## List

`netidx resolver list /solar/stats/*`

This sub command allows listing items in the resolver server that
match a specific pattern. It supports the full unix glob pattern set,
including `**` meaning any number of intermediate parents, and
`{thing1, thing2, thing3, ..}` for specifying specific sets. e.g. on
my machine I can get all the names under the `/solar` namespace that
begin with `battery` with the following query,

```
$ netidx resolver list /solar/**/battery*
/solar/settings/battery_charge_current_limit
/solar/stats/battery_v_max_daily
/solar/stats/battery_current_net
/solar/stats/battery_voltage_slow
/solar/stats/battery_voltage_settings_multiplier
/solar/stats/battery_sense_voltage
/solar/stats/battery_v_min_daily
/solar/stats/battery_temperature
/solar/stats/battery_terminal_voltage
```

### Args

List supports several arguments,

- `-n, --no-structure`: don't list matching items that are structural
  only. Only list items that are actually published.
- `-w, --watch`: don't quit, instead wait for new items matching the
  pattern and print them out as they appear.

## Table

This prints out the table desciptor for a path, which can tell you how
a given path will look in the browser by default. An example 10 row 5
column table generated by the stress publisher looks like this,

```
$ netidx resolver table /bench
columns:
2: 10
0: 10
1: 10
4: 10
3: 10
rows:
/bench/3
/bench/5
/bench/6
/bench/9
/bench/8
/bench/7
/bench/2
/bench/4
/bench/1
/bench/0
```

in the columns section, the number after the column name is the number
of rows in the table that have that column. Since this table is fully
populated every column is associated with 10 rows.

## Resolve

Given a path(s) this prints out all the information the resolver
server has about that path. This is what the subscriber uses to
connect to a publisher, and as such this tool is useful for debugging
subscription failures. Using the same stress publisher we saw above we
can query one cell in the table.

```
[eric@blackbird ~]$ netidx resolver resolve /local/bench/0/0
publisher: Publisher { resolver: 127.0.0.1:4564, id: PublisherId(3), addr: 127.0.0.1:5011, hash_method: Sha3_512, target_auth: Local }
PublisherId(3)
```

First all the publisher records are printed. This is the full
information about all the publishers that publish the requested
paths. Then, a list of publisher ids is printed, this is the publisher
id that corresponds to each path in the order the path was
specified. If we asked for two paths under the /local/bench namespace
then we will see how this works.

```
[eric@blackbird ~]$ netidx resolver resolve /local/bench/0/0 /local/bench/0/1
publisher: Publisher { resolver: 127.0.0.1:4564, id: PublisherId(3), addr: 127.0.0.1:5011, hash_method: Sha3_512, target_auth: Local }
PublisherId(3)
PublisherId(3)
```

Here we can clearly see that the same publisher (publisher id 3) is
the one to contact about both requested paths. This output closely
mirrors how the actual information is sent on the wire (except on the
wire it's binary, and the ids are varints).

In the case that no publisher is publishing the path you're resolving
the resolver will print nothing.

## Add

This is a low level debugging tool, and it's really not recommended
unless you know exactly what you're doing. Using it could screw up
subscriptions to whatever path you add for some time. That said, it's
pretty simple,

```
netidx resolver add /path/to/thing 192.168.0.5:5003
```

This entry will time out after a while because no publisher is there
to send heartbeats for it.

Note this will not work if your system is kerberos enabled, because
the resolver server checks that the publisher is actually listening on
the address it claims to be listening on, and that obviously can't
work in this case.

## Remove

This is actually worse than add in terms of danger, because you can
remove published things without the publisher knowing you did it, and
as a result you can make subscriptions fail until the publisher is
restarted. It also doesn't work if you are using kerberos, so that's something.

```
netidx resolver remove /path/to/thing 192.168.0.5:5003`
```
